{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPARKY</title>
    {% tailwind_css %}
    <!-- ลิงก์ Google Font Fahkwang -->
    <link href="https://fonts.googleapis.com/css2?family=Fahkwang:wght@400;600&display=swap" rel="stylesheet">
   
</head>
<body class="bg-[#9bc0ff] font-fahkwang">
    <div class="flex flex-col min-h-screen justify-center items-center">
            <div class="w-1/3 my-5">
                <div class="bg-white p-8 rounded-lg shadow-lg ">
                    
                    <div class=" my-3 text-center"> 
                        <h2 class="text-2xl font-bold">ข้อมูลโปรไฟล์</h2>
                    </div>  
                    <form  method="post" enctype="multipart/form-data" id="profileForm">
                        {% csrf_token %}
                        <div class="my-2">
                            <label>เลขประจำตัวประชาชน</label>
                        </div>
                        <input type="text" id="idCard" name="idCard" maxlength="13" pattern="\d{13}" required class="input input-bordered w-full  h-10" />

                        <div class="my-2">
                            <label>เบอร์โทรศัพท์มือถือ</label>
                        </div>
                        <input type="text" id="phone" name="phone"  maxlength="10" pattern="\d{10}" required class="input input-bordered w-full  h-10" />
                        
                        <div class="my-2">
                            <label>ที่อยู่</label>
                        </div>
                        <textarea type="textarea" id="address" name="address"  required class="textarea textarea-bordered w-full h-15"></textarea>

                        <div class="my-2">
                            <label>วันเกิด</label>
                        </div>
                        <input type="date" id="birthDate" name="birthDate"  required class="input input-bordered w-full  h-10" />

                        <div class="my-2">
                            <label>เพศ</label>
                        </div>
                        <select id="gender" name="gender" required class="select select-bordered w-1/3 max-w-xs">
                            <option value="" disabled selected>เลือกเพศ</option> 
                            <option value="ชาย">ชาย</option>
                            <option value="หญิง">หญิง</option>
                        </select>
                        
                        <div class="my-2">
                            <label>น้ำหนัก</label>
                        </div>
                        <input type="number" id="weight" name="weight"  required class="input input-bordered w-full  h-10" />

                        <div class="my-2">
                            <label>ส่วนสูง</label>
                        </div>
                        <input type="number" id="height" name="height"  required class="input input-bordered w-full  h-10" />

                        <div class="my-2">
                            <label>หมู่เลือด</label>
                        </div>
                        <select id="bloodType" name="bloodType" required class="select select-bordered w-1/3 max-w-xs">
                            <option value="" disabled selected>เลือกหมู่เลือด</option> 
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="AB">AB</option>
                            <option value="O">O</option>
                        </select>
                        
                        <div class="my-2">
                            <label>โรคประจำตัว</label>
                        </div>
                        <input type="text" id="ud" name="ud"  required class="input input-bordered w-full  h-10" />

                        <div class="my-2">
                            <label>อาการโรคประจำตัว</label>  
                        </div>
                        <textarea id="ud_symptoms" name="ud_symptoms" required class="textarea textarea-bordered w-full h-20"></textarea>
            
                                
                        <div class="my-2">
                            <label>ข้อมูลการแพ้ยา</label>
                        </div>
                        <input id="allergic" name="allergic" value="{{user.profile.allergic}}"  class="input input-bordered w-full  h-9" required/>

                        <div class="my-2">
                            <label>อาการแพ้ยา</label> 
                        </div>
                        <textarea id="allergic_symptoms" name="allergic_symptoms" required class="textarea textarea-bordered w-full h-20"></textarea>

                        <div class="my-2">
                            <label>รูปตนเอง</label>
                        </div>
                        <input type="file" id="image" name="image"  required class="file-input file-input-bordered  w-full h-10" />

                        <div class="mt-3 text-center">
                            <button class="btn btn-neutral text-white" type="button" onclick="showModal(event)">บันทึกข้อมูล</button>
                        </div>
                    </form>
                </div>
            </div>
    </div>

    <div id="confirmationModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-md w-1/2">
            <h2 class="text-xl mb-4 font-semibold">ยืนยันข้อมูล</h2>
            <p>กรุณายืนยันว่าคุณยินยอมให้ระบบเก็บข้อมูลส่วนตัวของคุณ ซึ่งรวมถึงข้อมูลที่เกี่ยวข้องกับการแพ้ยา, โรคประจำตัว, และข้อมูลสุขภาพอื่นๆ เพื่อการบริการที่เหมาะสมและปลอดภัย</p>
            <div class="mt-4 text-center">
                <button class="btn btn-neutral mr-4" onclick="submitForm()">ยืนยัน</button>
                <button class="btn btn-error" onclick="closeModal()">ยกเลิก</button>
            </div>
        </div>
    </div>
</body>   
</html>

<script>

    // Function to show the confirmation modal
    function showModal(event) {
        event.preventDefault();  // ป้องกันไม่ให้ฟอร์มถูกส่งก่อน
        // ตรวจสอบว่าไฟล์ถูกเลือกหรือไม่
        var fileInput = document.getElementById('image');
        if (!fileInput.files.length) {
            alert("กรุณาเลือกไฟล์รูปภาพ");
            return;
        }

        // ตรวจสอบฟิลด์ required อื่นๆ
        var form = document.getElementById('profileForm');
        if (!form.checkValidity()) {
            // หากฟอร์มไม่ครบถ้วน (ฟิลด์ required ยังไม่ได้กรอก)
            alert("กรุณากรอกข้อมูลให้ครบถ้วน");
            return;
        }

        document.getElementById('confirmationModal').classList.remove('hidden');
    }
    // Function to close the confirmation modal
    function closeModal() {
        document.getElementById('confirmationModal').classList.add('hidden');
    }

    // Function to submit the form
    function submitForm() {
        document.getElementById('profileForm').submit();
    }
</script>